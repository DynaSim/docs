<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of dsPlot</title>
  <meta name="keywords" content="dsPlot">
  <meta name="description" content="DSPlot - plot data in various ways depending on what data was provided and what options are defined.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>

<a name="_top"></a>
<div><a href="../menu.html">Home</a> &gt;  <a href="menu.html">functions</a> &gt; dsPlot.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../menu.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="menu.html">Index for functions&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>dsPlot
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>DSPlot - plot data in various ways depending on what data was provided and what options are defined.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function handles = dsPlot(data,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">DSPlot - plot data in various ways depending on what data was provided and what options are defined.

 This function is wrapped by dsPlotWaveforms, PlotPower, etc. to provide a single
 function for organizing and displaying data.

 Usage:
   handles=dsPlot(data,'option',value)

 Inputs:
   - data: DynaSim data structure (see dsCheckData)
   - options:
     'plot_type'       : what to plot {'waveform' (default),'rastergram','rates','power'}
     'variable'        : name of field containing data to plot (default: all
                         pops with state variable of variable in data.labels)
     'time_limits'     : in units of data.time {[beg,end]}
     'max_num_overlaid': maximum # of waveforms to overlay per plot
     'max_num_rows'    : maximum # of subplot rows per figure
     'xlim'            : x-axis limits {[XMIN XMAX]} (default: all data)
     'yscale'          : whether to plot linear or log scale {'linear','log','log10'}
     'visible'         : {'on','off'}
     'lock_gca'        : Plots within currently active axis (gca); doesn't
                         open new figures or subplots.
     - NOTE: analysis options are available depending on plot_type
       - see see dsCalcFR options for plot_type 'rastergram' or 'rates'
       - see dsCalcPower options for plot_type 'power'

 Outputs:
   - handles: graphic handles to figures

 Notes:
   if Nsims&gt;1: one sim per row
   elseif Npops&gt;1: one pop per row
   else: one cell per row

 Examples for specifying 'variable' option:
   []      : plot all data.labels with same variable name as first element of
             data.labels (eg, 'pop1_v' and 'pop2_v')
   '*'     : plot all data.labels
   '*_v'   : plot all data.labels ending in _v (i.e., all state variables 'v'
             for all populations)
   'pop1_*': plot all data.labels starting with pop1_ (i.e., all variables for
             population 'pop1')
   'pop1_v': plot only variable 'pop1_v'
   'v'     : look for all data.labels ending in _v then starting with v_ (eg,
             all populations with variable 'v')
   'pop1'  : look for all data.labels ending in _pop1 then starting with pop1_
             (eg, all variables for population 'pop1')
   '*_iNa_*': plot all data.labels for the 'iNa' mechanism (for all populations)

 Examples:
   - Example 1: One cell:
       data=dsSimulate('dv/dt=@current+10; {iNa,iK}','tspan',[0 500]);
       dsPlot(data); % plot first state variable ('v')
       dsPlot(data,'variable','*'); % plot all state variables
       % plot all variables and time 30-60ms
       dsPlot(data,'variable','*','time_limits',[30 60]);
       % plot power spectrum
       dsPlot(data,'variable','v','plot_type','power');
       dsPlot(data,'variable','*','plot_type','power');

   - Example 2: One population with noisy input:
       data=dsSimulate('dv[5]/dt=@current+10*(1+randn(1,Npop)); {iNa,iK}','tspan',[0 250]);
       dsPlot(data);
       dsPlot(data,'variable','*'); % plot all state variables (all cells)
       dsPlot(data,'variable','m'); % plot state variable 'm' (all cells)
       % plot all variables and time 30-60ms
       dsPlot(data,'variable','*','time_limits',[30 60]);
       % plot power spectrum
       dsPlot(data,'variable','v','plot_type','power');
       dsPlot(data,'variable','*','plot_type','power');
       % plot rastergram
       dsPlot(data,'variable','v','plot_type','rastergram');
       dsPlot(data,'variable','*','plot_type','rastergram');

   - Example 3: One population varying one parameter (input amplitude):
       eqns='dv[5]/dt=@current+amp*(1+randn(1,Npop)); {iNa,iK}';
       vary={'','amp',[0 10 20]};
       data=dsSimulate(eqns,'vary',vary,'tspan',[0 200]);
       dsPlot(data);
       dsPlot(data,'variable','m');
       dsPlot(data,'variable','*');
       % plot power spectrum
       dsPlot(data,'variable','v','plot_type','power');
       % plot rastergram
       dsPlot(data,'variable','v','plot_type','rastergram');

   - Example 4: One population varying two parameters (input amplitude and
                membrane capacitance):
       eqns='dv[5]/dt=@current/Cm+amp*(1+randn(1,Npop)); {iNa,iK}';
       vary={'','Cm',[1 2]; '','amp',[0 10 20]};
       data=dsSimulate(eqns,'vary',vary,'tspan',[0 200]);
       dsPlot(data);
       dsPlot(data,'variable','*');
       % plot power spectrum
       dsPlot(data,'variable','v','plot_type','power');
       % plot rastergram
       dsPlot(data,'variable','v','plot_type','rastergram');

   - Example 5: Two populations: noisy input to E and excitatory connection from E to I
       spec=[];
       spec.populations(1).name='E1';
       spec.populations(1).equations='dv[5]/dt=@current+amp*(1+randn(1,Npop)); amp=10; {iNa,iK}';
       spec.populations(2).name='E2';
       spec.populations(2).equations='dv[2]/dt=@current; {iNa,iK}';
       spec.connections(1).direction='E1-&gt;E2';
       spec.connections(1).mechanism_list='iAMPA';
       data=dsSimulate(spec,'tspan',[0 200]);
       dsPlot(data); % plot first state variable
       dsPlot(data,'variable','*');
       % plot monitored synaptic current with post-synaptic voltages:
       dsPlot(data,'variable',{'E2_v','ISYN'});
       % plot monitored synaptic current with pre- and post-synaptic voltages:
       dsPlot(data,'variable',{'v','ISYN'});
       % plot power spectrum
       dsPlot(data,'variable','v','plot_type','power');
       dsPlot(data,'variable',{'E2_v','ISYN'},'plot_type','power');
       % plot rastergram
       dsPlot(data,'variable','v','plot_type','rastergram');

   - Example 6: Two populations varying one parameter (input amplitude):
       vary={'E1','amp',[0 10 20]};
       data=dsSimulate(spec,'vary',vary,'tspan',[0 200]);
       dsPlot(data);
       dsPlot(data,'variable','*');
       dsPlot(data,'variable','*_iNa_*');
       % plot power spectrum
       dsPlot(data,'variable','v','plot_type','power');
       % plot rastergram
       dsPlot(data,'variable','v','plot_type','rastergram');

   - Example 7: Two populations varying two parameters (input amplitude and
                synaptic conductance):
       vary={'E1','amp',[0 10 20]; 'E1-&gt;E2','gSYN',[0 .05 .1]};
       data=dsSimulate(spec,'vary',vary,'tspan',[0 200]);
       % plot voltage waveforms
       dsPlot(data,'variable','v','plot_type','power');
       % plot voltage power spectrum
       dsPlot(data,'variable','v','plot_type','waveform');
       % plot voltage-derived rastergram
       dsPlot(data,'variable','v','plot_type','rastergram');
       % more plots
       dsPlot(data,'variable','ISYN');
       dsPlot(data,'variable','E1_v');
       dsPlot(data,'variable','*');

 See also: dsCalcFR, dsCalcPower, dsPlotWaveforms, dsCheckData

 Author: Jason Sherfey, PhD &lt;jssherfey@gmail.com&gt;
 Copyright (C) 2016 Jason Sherfey, Boston University, USA</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="dsPlot.html" class="code" title="function handles = dsPlot(data,varargin)">dsPlot</a>	DSPlot - plot data in various ways depending on what data was provided and what options are defined.</li><li><a href="../functions/internal/dsCalcFR.html" class="code" title="function data = dsCalcFR(data, varargin)">dsCalcFR</a>	CALCFR - Calculate firing rage for DynaSim data</li><li><a href="../functions/internal/dsCalcPower.html" class="code" title="function data = dsCalcPower(data, varargin)">dsCalcPower</a>	CALCPOWER - Compute spectral analysis of DynaSim data</li><li><a href="../functions/internal/dsCheckCovary.html" class="code" title="function [effective_vary_indices, linked_indices] = dsCheckCovary(vary_lengths, vary_params, varargin)">dsCheckCovary</a>	CHECKCOVARY - TODO I assume this checks if any varied parameters are covaried?</li><li><a href="../functions/internal/dsCheckData.html" class="code" title="function data = dsCheckData(data, varargin)">dsCheckData</a>	CHECKDATA - Standardize data structure and auto-populate missing fields</li><li><a href="../functions/internal/dsCheckOptions.html" class="code" title="function [parms, params_unspecified ] = dsCheckOptions(options, options_schema, strict)">dsCheckOptions</a>	CHECKOPTIONS - organize key/value pairs in structure with default or user-supplied values according to a schema</li><li><a href="../functions/internal/dsSelectVariables.html" class="code" title="function [variables,pop_names] = dsSelectVariables(labels,var_strings, varargin)">dsSelectVariables</a>	SELECTVARIABLES - determine what variables to plot</li><li><a href="../functions/internal/unit-test/dsUnitSaveAutoGenTestDir.html" class="code" title="function dsUnitSaveAutoGenTestDir(argin, argout, dirIn, dirOut, localFn_flag)">dsUnitSaveAutoGenTestDir</a>	Inputs:</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="dsPlot.html" class="code" title="function handles = dsPlot(data,varargin)">dsPlot</a>	DSPlot - plot data in various ways depending on what data was provided and what options are defined.</li><li><a href="../functions/internal/unit-test/dsUnitMake_autogenData.html" class="code" title="">dsUnitMake_autogenData</a>	% Make DynaSim Autogen Files</li><li><a href="../functions/internal/xp_libraries/xp_PlotData.html" class="code" title="function hxp = xp_PlotData (xp, op)">xp_PlotData</a>	xp must be 1x1 (e.g. 0 dimensional)</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function handles = dsPlot(data,varargin)</a>
0002 <span class="comment">%DSPlot - plot data in various ways depending on what data was provided and what options are defined.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% This function is wrapped by dsPlotWaveforms, PlotPower, etc. to provide a single</span>
0005 <span class="comment">% function for organizing and displaying data.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Usage:</span>
0008 <span class="comment">%   handles=dsPlot(data,'option',value)</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Inputs:</span>
0011 <span class="comment">%   - data: DynaSim data structure (see dsCheckData)</span>
0012 <span class="comment">%   - options:</span>
0013 <span class="comment">%     'plot_type'       : what to plot {'waveform' (default),'rastergram','rates','power'}</span>
0014 <span class="comment">%     'variable'        : name of field containing data to plot (default: all</span>
0015 <span class="comment">%                         pops with state variable of variable in data.labels)</span>
0016 <span class="comment">%     'time_limits'     : in units of data.time {[beg,end]}</span>
0017 <span class="comment">%     'max_num_overlaid': maximum # of waveforms to overlay per plot</span>
0018 <span class="comment">%     'max_num_rows'    : maximum # of subplot rows per figure</span>
0019 <span class="comment">%     'xlim'            : x-axis limits {[XMIN XMAX]} (default: all data)</span>
0020 <span class="comment">%     'yscale'          : whether to plot linear or log scale {'linear','log','log10'}</span>
0021 <span class="comment">%     'visible'         : {'on','off'}</span>
0022 <span class="comment">%     'lock_gca'        : Plots within currently active axis (gca); doesn't</span>
0023 <span class="comment">%                         open new figures or subplots.</span>
0024 <span class="comment">%     - NOTE: analysis options are available depending on plot_type</span>
0025 <span class="comment">%       - see see dsCalcFR options for plot_type 'rastergram' or 'rates'</span>
0026 <span class="comment">%       - see dsCalcPower options for plot_type 'power'</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% Outputs:</span>
0029 <span class="comment">%   - handles: graphic handles to figures</span>
0030 <span class="comment">%</span>
0031 <span class="comment">% Notes:</span>
0032 <span class="comment">%   if Nsims&gt;1: one sim per row</span>
0033 <span class="comment">%   elseif Npops&gt;1: one pop per row</span>
0034 <span class="comment">%   else: one cell per row</span>
0035 <span class="comment">%</span>
0036 <span class="comment">% Examples for specifying 'variable' option:</span>
0037 <span class="comment">%   []      : plot all data.labels with same variable name as first element of</span>
0038 <span class="comment">%             data.labels (eg, 'pop1_v' and 'pop2_v')</span>
0039 <span class="comment">%   '*'     : plot all data.labels</span>
0040 <span class="comment">%   '*_v'   : plot all data.labels ending in _v (i.e., all state variables 'v'</span>
0041 <span class="comment">%             for all populations)</span>
0042 <span class="comment">%   'pop1_*': plot all data.labels starting with pop1_ (i.e., all variables for</span>
0043 <span class="comment">%             population 'pop1')</span>
0044 <span class="comment">%   'pop1_v': plot only variable 'pop1_v'</span>
0045 <span class="comment">%   'v'     : look for all data.labels ending in _v then starting with v_ (eg,</span>
0046 <span class="comment">%             all populations with variable 'v')</span>
0047 <span class="comment">%   'pop1'  : look for all data.labels ending in _pop1 then starting with pop1_</span>
0048 <span class="comment">%             (eg, all variables for population 'pop1')</span>
0049 <span class="comment">%   '*_iNa_*': plot all data.labels for the 'iNa' mechanism (for all populations)</span>
0050 <span class="comment">%</span>
0051 <span class="comment">% Examples:</span>
0052 <span class="comment">%   - Example 1: One cell:</span>
0053 <span class="comment">%       data=dsSimulate('dv/dt=@current+10; {iNa,iK}','tspan',[0 500]);</span>
0054 <span class="comment">%       dsPlot(data); % plot first state variable ('v')</span>
0055 <span class="comment">%       dsPlot(data,'variable','*'); % plot all state variables</span>
0056 <span class="comment">%       % plot all variables and time 30-60ms</span>
0057 <span class="comment">%       dsPlot(data,'variable','*','time_limits',[30 60]);</span>
0058 <span class="comment">%       % plot power spectrum</span>
0059 <span class="comment">%       dsPlot(data,'variable','v','plot_type','power');</span>
0060 <span class="comment">%       dsPlot(data,'variable','*','plot_type','power');</span>
0061 <span class="comment">%</span>
0062 <span class="comment">%   - Example 2: One population with noisy input:</span>
0063 <span class="comment">%       data=dsSimulate('dv[5]/dt=@current+10*(1+randn(1,Npop)); {iNa,iK}','tspan',[0 250]);</span>
0064 <span class="comment">%       dsPlot(data);</span>
0065 <span class="comment">%       dsPlot(data,'variable','*'); % plot all state variables (all cells)</span>
0066 <span class="comment">%       dsPlot(data,'variable','m'); % plot state variable 'm' (all cells)</span>
0067 <span class="comment">%       % plot all variables and time 30-60ms</span>
0068 <span class="comment">%       dsPlot(data,'variable','*','time_limits',[30 60]);</span>
0069 <span class="comment">%       % plot power spectrum</span>
0070 <span class="comment">%       dsPlot(data,'variable','v','plot_type','power');</span>
0071 <span class="comment">%       dsPlot(data,'variable','*','plot_type','power');</span>
0072 <span class="comment">%       % plot rastergram</span>
0073 <span class="comment">%       dsPlot(data,'variable','v','plot_type','rastergram');</span>
0074 <span class="comment">%       dsPlot(data,'variable','*','plot_type','rastergram');</span>
0075 <span class="comment">%</span>
0076 <span class="comment">%   - Example 3: One population varying one parameter (input amplitude):</span>
0077 <span class="comment">%       eqns='dv[5]/dt=@current+amp*(1+randn(1,Npop)); {iNa,iK}';</span>
0078 <span class="comment">%       vary={'','amp',[0 10 20]};</span>
0079 <span class="comment">%       data=dsSimulate(eqns,'vary',vary,'tspan',[0 200]);</span>
0080 <span class="comment">%       dsPlot(data);</span>
0081 <span class="comment">%       dsPlot(data,'variable','m');</span>
0082 <span class="comment">%       dsPlot(data,'variable','*');</span>
0083 <span class="comment">%       % plot power spectrum</span>
0084 <span class="comment">%       dsPlot(data,'variable','v','plot_type','power');</span>
0085 <span class="comment">%       % plot rastergram</span>
0086 <span class="comment">%       dsPlot(data,'variable','v','plot_type','rastergram');</span>
0087 <span class="comment">%</span>
0088 <span class="comment">%   - Example 4: One population varying two parameters (input amplitude and</span>
0089 <span class="comment">%                membrane capacitance):</span>
0090 <span class="comment">%       eqns='dv[5]/dt=@current/Cm+amp*(1+randn(1,Npop)); {iNa,iK}';</span>
0091 <span class="comment">%       vary={'','Cm',[1 2]; '','amp',[0 10 20]};</span>
0092 <span class="comment">%       data=dsSimulate(eqns,'vary',vary,'tspan',[0 200]);</span>
0093 <span class="comment">%       dsPlot(data);</span>
0094 <span class="comment">%       dsPlot(data,'variable','*');</span>
0095 <span class="comment">%       % plot power spectrum</span>
0096 <span class="comment">%       dsPlot(data,'variable','v','plot_type','power');</span>
0097 <span class="comment">%       % plot rastergram</span>
0098 <span class="comment">%       dsPlot(data,'variable','v','plot_type','rastergram');</span>
0099 <span class="comment">%</span>
0100 <span class="comment">%   - Example 5: Two populations: noisy input to E and excitatory connection from E to I</span>
0101 <span class="comment">%       spec=[];</span>
0102 <span class="comment">%       spec.populations(1).name='E1';</span>
0103 <span class="comment">%       spec.populations(1).equations='dv[5]/dt=@current+amp*(1+randn(1,Npop)); amp=10; {iNa,iK}';</span>
0104 <span class="comment">%       spec.populations(2).name='E2';</span>
0105 <span class="comment">%       spec.populations(2).equations='dv[2]/dt=@current; {iNa,iK}';</span>
0106 <span class="comment">%       spec.connections(1).direction='E1-&gt;E2';</span>
0107 <span class="comment">%       spec.connections(1).mechanism_list='iAMPA';</span>
0108 <span class="comment">%       data=dsSimulate(spec,'tspan',[0 200]);</span>
0109 <span class="comment">%       dsPlot(data); % plot first state variable</span>
0110 <span class="comment">%       dsPlot(data,'variable','*');</span>
0111 <span class="comment">%       % plot monitored synaptic current with post-synaptic voltages:</span>
0112 <span class="comment">%       dsPlot(data,'variable',{'E2_v','ISYN'});</span>
0113 <span class="comment">%       % plot monitored synaptic current with pre- and post-synaptic voltages:</span>
0114 <span class="comment">%       dsPlot(data,'variable',{'v','ISYN'});</span>
0115 <span class="comment">%       % plot power spectrum</span>
0116 <span class="comment">%       dsPlot(data,'variable','v','plot_type','power');</span>
0117 <span class="comment">%       dsPlot(data,'variable',{'E2_v','ISYN'},'plot_type','power');</span>
0118 <span class="comment">%       % plot rastergram</span>
0119 <span class="comment">%       dsPlot(data,'variable','v','plot_type','rastergram');</span>
0120 <span class="comment">%</span>
0121 <span class="comment">%   - Example 6: Two populations varying one parameter (input amplitude):</span>
0122 <span class="comment">%       vary={'E1','amp',[0 10 20]};</span>
0123 <span class="comment">%       data=dsSimulate(spec,'vary',vary,'tspan',[0 200]);</span>
0124 <span class="comment">%       dsPlot(data);</span>
0125 <span class="comment">%       dsPlot(data,'variable','*');</span>
0126 <span class="comment">%       dsPlot(data,'variable','*_iNa_*');</span>
0127 <span class="comment">%       % plot power spectrum</span>
0128 <span class="comment">%       dsPlot(data,'variable','v','plot_type','power');</span>
0129 <span class="comment">%       % plot rastergram</span>
0130 <span class="comment">%       dsPlot(data,'variable','v','plot_type','rastergram');</span>
0131 <span class="comment">%</span>
0132 <span class="comment">%   - Example 7: Two populations varying two parameters (input amplitude and</span>
0133 <span class="comment">%                synaptic conductance):</span>
0134 <span class="comment">%       vary={'E1','amp',[0 10 20]; 'E1-&gt;E2','gSYN',[0 .05 .1]};</span>
0135 <span class="comment">%       data=dsSimulate(spec,'vary',vary,'tspan',[0 200]);</span>
0136 <span class="comment">%       % plot voltage waveforms</span>
0137 <span class="comment">%       dsPlot(data,'variable','v','plot_type','power');</span>
0138 <span class="comment">%       % plot voltage power spectrum</span>
0139 <span class="comment">%       dsPlot(data,'variable','v','plot_type','waveform');</span>
0140 <span class="comment">%       % plot voltage-derived rastergram</span>
0141 <span class="comment">%       dsPlot(data,'variable','v','plot_type','rastergram');</span>
0142 <span class="comment">%       % more plots</span>
0143 <span class="comment">%       dsPlot(data,'variable','ISYN');</span>
0144 <span class="comment">%       dsPlot(data,'variable','E1_v');</span>
0145 <span class="comment">%       dsPlot(data,'variable','*');</span>
0146 <span class="comment">%</span>
0147 <span class="comment">% See also: dsCalcFR, dsCalcPower, dsPlotWaveforms, dsCheckData</span>
0148 <span class="comment">%</span>
0149 <span class="comment">% Author: Jason Sherfey, PhD &lt;jssherfey@gmail.com&gt;</span>
0150 <span class="comment">% Copyright (C) 2016 Jason Sherfey, Boston University, USA</span>
0151 
0152 <span class="comment">% Check inputs</span>
0153 data=<a href="../functions/internal/dsCheckData.html" class="code" title="function data = dsCheckData(data, varargin)">dsCheckData</a>(data, varargin{:});
0154   <span class="comment">% NOTE: calling dsCheckData() at beginning enables analysis/plotting functions to</span>
0155   <span class="comment">%       accept data matrix [time x cells] in addition to DynaSim data structure.</span>
0156 
0157 <span class="comment">% get options</span>
0158 options=<a href="../functions/internal/dsCheckOptions.html" class="code" title="function [parms, params_unspecified ] = dsCheckOptions(options, options_schema, strict)">dsCheckOptions</a>(varargin,{<span class="keyword">...</span>
0159   <span class="string">'time_limits'</span>,[-inf inf],[],<span class="keyword">...</span>
0160   <span class="string">'variable'</span>,[],[],<span class="keyword">...</span>
0161   <span class="string">'max_num_overlaid'</span>,50,[],<span class="keyword">...</span>
0162   <span class="string">'max_num_rows'</span>,20,[],<span class="keyword">...</span>
0163   <span class="string">'plot_mode'</span>,<span class="string">'trace'</span>,{<span class="string">'trace'</span>,<span class="string">'image'</span>},<span class="keyword">...</span>
0164   <span class="string">'plot_type'</span>,<span class="string">'waveform'</span>,{<span class="string">'waveform'</span>,<span class="string">'rastergram'</span>,<span class="string">'raster'</span>,<span class="string">'power'</span>,<span class="string">'rates'</span>},<span class="keyword">...</span>
0165   <span class="string">'xlim'</span>,[],[],<span class="keyword">...</span>
0166   <span class="string">'ylim'</span>,[],[],<span class="keyword">...</span>
0167   <span class="string">'figwidth'</span>,[1],[],<span class="keyword">...</span>
0168   <span class="string">'figheight'</span>,[1],[],<span class="keyword">...</span>
0169   <span class="string">'lock_gca'</span>,[false],[false, true],<span class="keyword">...</span>
0170   <span class="string">'yscale'</span>,<span class="string">'linear'</span>,{<span class="string">'linear'</span>,<span class="string">'log'</span>,<span class="string">'log10'</span>,<span class="string">'log2'</span>},<span class="keyword">...</span>
0171   <span class="string">'visible'</span>,<span class="string">'on'</span>,{<span class="string">'on'</span>,<span class="string">'off'</span>},<span class="keyword">...</span>
0172   <span class="string">'auto_gen_test_data_flag'</span>,0,{0,1},<span class="keyword">...</span>
0173   },false);
0174 
0175 <span class="comment">%% auto_gen_test_data_flag argin</span>
0176 <span class="keyword">if</span> options.auto_gen_test_data_flag
0177   varargs = varargin;
0178   varargs{find(strcmp(varargs, <span class="string">'auto_gen_test_data_flag'</span>))+1} = 0;
0179   varargs(end+1:end+2) = {<span class="string">'unit_test_flag'</span>,1};
0180   argin = [{data}, varargs]; <span class="comment">% specific to this function</span>
0181 <span class="keyword">end</span>
0182 
0183 
0184 <span class="comment">%% varied fields</span>
0185 
0186 <span class="comment">% Make sure there is no empty</span>
0187 labels = data(1).labels;
0188 inds = arrayfun(@(s) ~isempty(s.(labels{1})),data);
0189 data = data(inds);
0190 
0191 
0192 fields=fieldnames(data);
0193 <span class="keyword">if</span> any(strcmp(fields, <span class="string">'varied'</span>))
0194   <span class="comment">% get varied labels</span>
0195   vary_labels = data(1).varied; <span class="comment">% data(1).simulator_options.vary;</span>
0196   no_vary_labels = length(vary_labels);
0197   vary_params = nan(length(data), no_vary_labels);
0198   vary_vectors = cell(no_vary_labels, 1);
0199   vary_lengths = nan(no_vary_labels, 1);
0200 
0201   <span class="comment">% get varied params</span>
0202   <span class="keyword">for</span> v = 1:no_vary_labels
0203     vary_params(:, v) = [data.(vary_labels{v})];
0204     vary_vectors{v} = unique(vary_params(:, v));
0205     vary_lengths(v) = length(vary_vectors{v});
0206   <span class="keyword">end</span>
0207 
0208   [effective_vary_indices, ~] = <a href="../functions/internal/dsCheckCovary.html" class="code" title="function [effective_vary_indices, linked_indices] = dsCheckCovary(vary_lengths, vary_params, varargin)">dsCheckCovary</a>(vary_lengths, vary_params, varargin{:});
0209 
0210   <span class="keyword">if</span> prod(vary_lengths(effective_vary_indices)) == length(data)
0211 
0212       dimensions_varied = sum(effective_vary_indices);
0213       vary_params = vary_params(:, effective_vary_indices);
0214       vary_vectors = vary_vectors(effective_vary_indices);
0215       vary_lengths = vary_lengths(effective_vary_indices);
0216 
0217   <span class="keyword">else</span>
0218 
0219       warning(<span class="string">'unable to determine which parameters are covaried. Data will be plotted as a lattice.'</span>)
0220 
0221       dimensions_varied = 1;
0222 
0223   <span class="keyword">end</span>
0224 
0225   <span class="keyword">if</span> dimensions_varied &gt; 2
0226     no_figures = prod(vary_lengths(3:end));
0227 
0228     figure_params = nan(dimensions_varied - 2, 1);
0229 
0230     vary_lengths_cp = cumprod(vary_lengths);
0231 
0232     <span class="keyword">for</span> f = 1:no_figures
0233       figure_params(1) = vary_vectors{3}(mod(f - 1, vary_lengths(3)) + 1);
0234 
0235       <span class="keyword">for</span> v = 4:dimensions_varied
0236         figure_params(v - 2) = vary_vectors{v}(ceil(f/vary_lengths_cp(v - 3)));
0237       <span class="keyword">end</span>
0238 
0239       figure_data_index = ones(size(vary_params, 1), 1);
0240       <span class="keyword">for</span> v = 3:dimensions_varied
0241         figure_data_index = figure_data_index &amp; vary_params(:, v) == figure_params(v - 2);
0242       <span class="keyword">end</span>
0243 
0244       vary_title = <span class="string">''</span>;
0245 
0246       <span class="keyword">for</span> v = 1:(dimensions_varied - 2)
0247         vary_title = [vary_title, sprintf(<span class="string">'%s = %f '</span>, vary_labels{v + 2}, figure_params(v))];
0248       <span class="keyword">end</span>
0249 
0250       handles = <a href="dsPlot.html" class="code" title="function handles = dsPlot(data,varargin)">dsPlot</a>(data(figure_data_index), varargin{:});
0251       <span class="keyword">for</span> h = 1:length(handles)
0252         <span class="comment">% figure(handles(h))</span>
0253         mtit(handles(h), vary_title, <span class="string">'FontSize'</span>, 14, <span class="string">'yoff'</span>, .2)
0254       <span class="keyword">end</span>
0255 
0256     <span class="keyword">end</span> <span class="comment">% no_figures</span>
0257     <span class="keyword">return</span>
0258   <span class="keyword">end</span> <span class="comment">% dimensions_varied</span>
0259 <span class="keyword">end</span>
0260 
0261 data=<a href="../functions/internal/dsCheckData.html" class="code" title="function data = dsCheckData(data, varargin)">dsCheckData</a>(data, varargin{:});
0262 handles=[];
0263 
0264 lock_gca = options.lock_gca;
0265 
0266 <span class="comment">% TODO: add option 'plot_mode' {'trace','image'}</span>
0267 
0268 <span class="comment">% variables to plot</span>
0269 var_fields=<a href="../functions/internal/dsSelectVariables.html" class="code" title="function [variables,pop_names] = dsSelectVariables(labels,var_strings, varargin)">dsSelectVariables</a>(data(1).labels,options.variable, varargin{:});
0270 tmp=regexp(var_fields,<span class="string">'_(.+)$'</span>,<span class="string">'tokens'</span>,<span class="string">'once'</span>);
0271 variables=unique([tmp{:}]);
0272 
0273 <span class="comment">% populations to plot</span>
0274 pop_names={data(1).model.specification.populations.name}; <span class="comment">% list of populations</span>
0275 <span class="comment">% restrict to populations with variables to plot</span>
0276 pop_indices=[];     <span class="comment">% indices of populations to plot</span>
0277 pop_var_indices={}; <span class="comment">% indices of var_fields to plot per population</span>
0278   <span class="comment">% pop_var_indices{pop}(variable): index into var_fields</span>
0279 <span class="keyword">for</span> i=1:length(pop_names)
0280   <span class="comment">% do any variables start with this population name?</span>
0281   var_inds=find(~cellfun(@isempty,regexp(var_fields,[<span class="string">'^'</span> pop_names{i}])));
0282   <span class="keyword">if</span> any(var_inds)
0283     inds=cellfun(@(x)find(~cellfun(@isempty,regexp(var_fields(var_inds),[<span class="string">'_'</span> x <span class="string">'$'</span>],<span class="string">'once'</span>))),variables,<span class="string">'uni'</span>,0);
0284     varsel=~cellfun(@isempty,inds);
0285     fldind=unique([inds{:}]);
0286     pop_indices(end+1)=i;
0287     pop_var_indices{end+1}=nan(1,length(variables));
0288     pop_var_indices{end}(varsel)=var_inds(fldind);
0289   <span class="keyword">end</span>
0290 <span class="keyword">end</span>
0291 pop_names=pop_names(pop_indices);
0292 
0293 <span class="comment">% data set info</span>
0294 time=data(1).time; <span class="comment">% time vector</span>
0295 pop_sizes=[data(1).model.specification.populations(pop_indices).size];
0296 num_pops=length(pop_names); <span class="comment">% number of populations to plot</span>
0297 num_sims=length(data); <span class="comment">% number of simulations</span>
0298 num_vars=length(variables);
0299 num_labels=length(var_fields); <span class="comment">% number of labels to plot</span>
0300 num_times=length(time);
0301 <span class="comment">% set x-axis limits</span>
0302 <span class="keyword">if</span> isempty(options.time_limits)
0303   options.time_limits=[min(time) max(time)];
0304 <span class="keyword">end</span>
0305 
0306 <span class="comment">% do any analysis if necessary and set x-data</span>
0307 <span class="keyword">switch</span> options.plot_type
0308   <span class="keyword">case</span> <span class="string">'waveform'</span>   <span class="comment">% plot VARIABLE</span>
0309     xdata=time;
0310     xlab=<span class="string">'time (ms)'</span>; <span class="comment">% x-axis label</span>
0311   <span class="keyword">case</span> <span class="string">'power'</span>      <span class="comment">% plot VARIABLE_Power_SUA.Pxx</span>
0312     <span class="keyword">if</span> any(cellfun(@isempty,regexp(var_fields,<span class="string">'.*_Power_SUA$'</span>)))
0313       data=<a href="../functions/internal/dsCalcPower.html" class="code" title="function data = dsCalcPower(data, varargin)">dsCalcPower</a>(data,varargin{:});
0314     <span class="keyword">end</span>
0315     xdata=data(1).([var_fields{1} <span class="string">'_Power_SUA'</span>]).frequency;
0316     xlab=<span class="string">'frequency (Hz)'</span>; <span class="comment">% x-axis label</span>
0317     <span class="comment">% set default x-limits for power spectrum</span>
0318     <span class="keyword">if</span> isempty(options.xlim)
0319       options.xlim=[0 200]; <span class="comment">% Hz</span>
0320     <span class="keyword">end</span>
0321   <span class="keyword">case</span> {<span class="string">'rastergram'</span>,<span class="string">'raster'</span>} <span class="comment">% raster VARIABLE_spike_times</span>
0322     <span class="keyword">if</span> any(cellfun(@isempty,regexp(var_fields,<span class="string">'.*_spike_times$'</span>)))
0323       spike_fields=cellfun(@(x)[x <span class="string">'_spikes'</span>],var_fields,<span class="string">'uni'</span>,0);
0324       idx=cellfun(@(x)isfield(data,x),spike_fields);
0325       <span class="keyword">if</span> any(idx)
0326         <span class="comment">% get spike times from binary spike matrix</span>
0327         inds=find(idx);
0328         <span class="keyword">for</span> s=1:length(data) <span class="comment">% sims</span>
0329           <span class="keyword">for</span> i=1:length(inds) <span class="comment">% pops</span>
0330             spike_fld=[var_fields{inds(i)} <span class="string">'_spikes'</span>];
0331             spike_time_fld=[var_fields{inds(i)} <span class="string">'_spike_times'</span>];
0332             <span class="keyword">for</span> j=1:size(data(s).(spike_fld),2) <span class="comment">% cells</span>
0333               data(s).(spike_time_fld){j}=data(s).time((1==data(s).(spike_fld)(:,j)));
0334             <span class="keyword">end</span> <span class="comment">% cells</span>
0335           <span class="keyword">end</span> <span class="comment">% pops</span>
0336         <span class="keyword">end</span> <span class="comment">% sims</span>
0337 <span class="comment">%       rmfields=cellfun(@(x)[x '_spikes'],var_fields,'uni',0);</span>
0338 <span class="comment">%       idx=cellfun(@(x)isfield(data,x),rmfields);</span>
0339 <span class="comment">%       if any(idx)</span>
0340 <span class="comment">%          data=rmfield(data,rmfields);</span>
0341 <span class="comment">%          data.labels=setdiff(data.labels,rmfields,'stable');</span>
0342 <span class="comment">%       end</span>
0343       <span class="keyword">else</span>
0344         <span class="comment">% find spikes from threshold crossing</span>
0345         data=<a href="../functions/internal/dsCalcFR.html" class="code" title="function data = dsCalcFR(data, varargin)">dsCalcFR</a>(data,varargin{:});
0346       <span class="keyword">end</span>
0347     <span class="keyword">end</span>
0348     xdata=time;
0349     xlab=<span class="string">'time (ms)'</span>; <span class="comment">% x-axis label</span>
0350   <span class="keyword">case</span> <span class="string">'rates'</span>      <span class="comment">% plot VARIABLE_FR</span>
0351     <span class="keyword">if</span> any(cellfun(@isempty,regexp(var_fields,<span class="string">'.*_FR$'</span>)))
0352       data=<a href="../functions/internal/dsCalcFR.html" class="code" title="function data = dsCalcFR(data, varargin)">dsCalcFR</a>(data,varargin{:});
0353     <span class="keyword">end</span>
0354     xdata=data.time_FR;
0355     xlab=<span class="string">'time (ms, bins)'</span>; <span class="comment">% x-axis label</span>
0356 <span class="keyword">end</span>
0357 <span class="keyword">if</span> isempty(options.xlim)
0358   options.xlim=[min(xdata) max(xdata)];
0359 <span class="keyword">end</span>
0360 
0361 MRPF = options.max_num_rows; <span class="comment">% max rows per fig</span>
0362 MTPP = options.max_num_overlaid; <span class="comment">% max traces per plot</span>
0363 
0364 <span class="comment">% how many plots:</span>
0365 <span class="keyword">if</span> num_sims==1 &amp;&amp; num_pops==1 &amp;&amp; num_vars==1 &amp;&amp; ~lock_gca
0366   num_fig_sets=1; num_figs=ceil(pop_sizes/MRPF); num_rows=min(pop_sizes,MRPF);
0367 <span class="keyword">elseif</span> num_sims==1 &amp;&amp; num_pops==1 &amp;&amp; num_vars==1 &amp;&amp; lock_gca
0368   num_fig_sets=1; num_figs=1; num_rows=1;
0369 <span class="keyword">elseif</span> num_sims==1 &amp;&amp; num_pops==1 &amp;&amp; num_vars&gt;1
0370   num_fig_sets=1; num_figs=ceil(num_vars/MRPF); num_rows=min(num_vars,MRPF);
0371 <span class="keyword">elseif</span> num_sims==1 &amp;&amp; num_pops&gt;1 &amp;&amp; num_vars==1 &amp;&amp; ~lock_gca
0372   num_fig_sets=1; num_figs=ceil(num_pops/MRPF); num_rows=min(num_pops,MRPF);
0373 <span class="keyword">elseif</span> num_sims==1 &amp;&amp; num_pops&gt;1 &amp;&amp; num_vars==1 &amp;&amp; lock_gca
0374   num_fig_sets=1; num_figs=ceil(num_pops/MRPF); num_rows=1;
0375 <span class="keyword">elseif</span> num_sims==1 &amp;&amp; num_pops&gt;1 &amp;&amp; num_vars&gt;1
0376   num_fig_sets=num_vars; num_figs=ceil(num_pops/MRPF); num_rows=min(num_pops,MRPF);
0377 <span class="keyword">elseif</span> num_sims&gt;1 &amp;&amp; num_pops==1 &amp;&amp; num_vars==1
0378   num_fig_sets=1; num_figs=ceil(num_sims/MRPF); num_rows=min(num_sims,MRPF);
0379 <span class="keyword">elseif</span> num_sims&gt;1 &amp;&amp; num_pops==1 &amp;&amp; num_vars&gt;1
0380   num_fig_sets=num_vars; num_figs=ceil(num_sims/MRPF); num_rows=min(num_sims,MRPF);
0381 <span class="keyword">elseif</span> num_sims&gt;1 &amp;&amp; num_pops&gt;1 &amp;&amp; num_vars==1
0382   num_fig_sets=1; num_figs=ceil(num_sims/MRPF); num_rows=min(num_sims,MRPF);
0383 <span class="keyword">elseif</span> num_sims&gt;1 &amp;&amp; num_pops&gt;1 &amp;&amp; num_vars&gt;1
0384   num_fig_sets=num_vars; num_figs=ceil(num_sims/MRPF); num_rows=min(num_sims,MRPF);
0385 <span class="keyword">else</span>
0386   error(<span class="string">'unrecognized dimensions'</span>);
0387 <span class="keyword">end</span>
0388 
0389 <span class="comment">% If are doing rastergram, pops can be greater than 1 when doing lock_gca</span>
0390 <span class="keyword">if</span> lock_gca &amp;&amp; (num_sims&gt;1 || num_vars&gt;1)
0391     error(<span class="string">'Option lock_gca cannot with more than one simulation or variable'</span>);
0392 <span class="keyword">end</span>
0393 
0394 <span class="comment">% make subplot adjustments for varied parameters</span>
0395 <span class="keyword">if</span> num_sims&gt;1 &amp;&amp; isfield(data,<span class="string">'varied'</span>)
0396   <span class="comment">% collect info on parameters varied</span>
0397   varied=data(1).varied;
0398   num_varied=length(varied); <span class="comment">% number of model components varied across simulations</span>
0399   num_sims=length(data); <span class="comment">% number of data sets (one per simulation)</span>
0400   <span class="comment">% collect info on parameters varied</span>
0401   param_mat=zeros(num_sims,num_varied); <span class="comment">% values for each simulation</span>
0402   param_cell=cell(1,num_varied); <span class="comment">% unique values for each parameter</span>
0403   <span class="comment">% loop over varied components and collect values</span>
0404   <span class="keyword">for</span> j=1:num_varied
0405     <span class="keyword">if</span> isnumeric(data(1).(varied{j}))
0406       param_mat(:,j)=[data.(varied{j})]; <span class="comment">% values for each simulation</span>
0407       param_cell{j}=unique([data.(varied{j})]); <span class="comment">% unique values for each parameter</span>
0408     <span class="keyword">else</span>
0409       <span class="comment">% TODO: handle sims varying non-numeric model components</span>
0410       <span class="comment">% (eg, mechanisms) (also in dsPlotFR and dsSelect)</span>
0411     <span class="keyword">end</span>
0412   <span class="keyword">end</span>
0413   param_size=cellfun(@length,param_cell); <span class="comment">% number of unique values for each parameter</span>
0414   <span class="comment">% varied parameter with most elements goes along the rows (everything else goes along columns)</span>
0415   row_param_index=find(param_size==max(param_size),1,<span class="string">'first'</span>);
0416   row_param_name=varied{row_param_index};
0417   row_param_values=param_cell{row_param_index};
0418   num_rows=length(row_param_values);
0419   <span class="comment">%num_cols=num_sims/num_rows;</span>
0420   num_figs=ceil(num_rows/MRPF);
0421   <span class="comment">% collect sims for each value of the row parameter</span>
0422   indices={};
0423   <span class="keyword">for</span> row=1:num_rows
0424     indices{row}=find(param_mat(:,row_param_index)==row_param_values(row));
0425   <span class="keyword">end</span>
0426   num_per_row=cellfun(@length,indices);
0427   num_cols=max(num_per_row);
0428   sim_indices=nan(num_cols,num_rows);
0429   <span class="comment">% arrange sim indices for each row in a matrix</span>
0430   <span class="keyword">for</span> row=1:num_rows
0431     sim_indices(1:num_per_row(row),row)=indices{row};
0432   <span class="keyword">end</span>
0433 <span class="comment">%   sim_indices=[];</span>
0434 <span class="comment">%   for row=1:num_rows</span>
0435 <span class="comment">%     sim_indices=[sim_indices find(param_mat(:,row_param_index)==row_param_values(row))];</span>
0436 <span class="comment">%   end</span>
0437 <span class="keyword">else</span>
0438   sim_indices=ones(1,num_rows); <span class="comment">% index into data array</span>
0439   num_cols=1;
0440 <span class="keyword">end</span>
0441 
0442 max_legend_entries=10;
0443 <span class="keyword">for</span> figset=1:num_fig_sets
0444   <span class="keyword">for</span> fig=1:num_figs
0445     ylims=[nan nan];
0446     <span class="comment">% create figure</span>
0447     <span class="keyword">if</span> ~lock_gca
0448         handles(end+1)=figure(<span class="string">'units'</span>,<span class="string">'normalized'</span>,<span class="string">'outerposition'</span>,[0 0 options.figwidth, options.figheight],<span class="string">'visible'</span>,options.visible);
0449         <span class="comment">% position axes</span>
0450         haxes=tight_subplot(num_rows,num_cols,[.01 .03],[.05 .01],[.03 .01]);
0451     <span class="keyword">else</span>
0452         handles = gcf;
0453         haxes = gca;
0454     <span class="keyword">end</span>
0455 
0456     axis_counter=0;
0457     AuxData=[];
0458     vlines=[];
0459     allspikes={};
0460     text_string=<span class="string">''</span>; <span class="comment">% string to add to subplot (set below)</span>
0461     legend_strings=<span class="string">''</span>; <span class="comment">% legend for subplot (set below)</span>
0462     shared_ylims_flag=1;
0463     <span class="comment">% draw plots</span>
0464     <span class="keyword">for</span> row=1:num_rows
0465       <span class="keyword">for</span> col=1:num_cols
0466         dat=[];
0467         sim_index=sim_indices(col,row); <span class="comment">% index into data array for this subplot</span>
0468         axis_counter=axis_counter+1; <span class="comment">% number subplot axis we're on</span>
0469         <span class="keyword">if</span> isnan(sim_index)
0470           <span class="keyword">continue</span>;
0471         <span class="keyword">end</span>
0472         <span class="comment">% #################################################################</span>
0473         <span class="comment">% what to plot</span>
0474         <span class="comment">% -----------------------------------------------------------------</span>
0475 
0476         <span class="keyword">if</span> num_sims==1 &amp;&amp; num_pops==1 &amp;&amp; num_vars==1 &amp;&amp; ~lock_gca
0477         <span class="comment">% -----------------------------------------------------------------</span>
0478           <span class="comment">% one cell per row: dat = data(s=1).(var)(:,c=r) where var=vars{v=1}</span>
0479           var=var_fields{1};
0480           <span class="keyword">switch</span> options.plot_type
0481             <span class="keyword">case</span> <span class="string">'waveform'</span>
0482               dat=data(sim_index).(var)(:,row);
0483             <span class="keyword">case</span> <span class="string">'power'</span>
0484               AuxData=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).Pxx;
0485               vlines=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).PeakFreq;
0486               AuxDataName={<span class="string">'MUA Power'</span>};
0487               var=[var <span class="string">'_Power_SUA'</span>];
0488               dat=data(sim_index).(var).Pxx(:,row);
0489               legend_strings={<span class="string">'SUA'</span>,<span class="string">'MUA'</span>};
0490             <span class="keyword">case</span> {<span class="string">'rastergram'</span>,<span class="string">'raster'</span>}
0491               set_name=regexp(var,<span class="string">'^([a-zA-Z0-9]+)_'</span>,<span class="string">'tokens'</span>,<span class="string">'once'</span>);
0492               allspikes{1}{1}=data(sim_index).([var <span class="string">'_spike_times'</span>]){row};
0493                 <span class="comment">% one pop, cell array of spike times for each cell in population</span>
0494           <span class="keyword">end</span>
0495           <span class="keyword">if</span> num_rows&gt;1
0496             text_string{row,col}=sprintf(<span class="string">'cell %g'</span>,row);
0497           <span class="keyword">end</span>
0498 
0499         <span class="keyword">elseif</span> num_sims==1 &amp;&amp; num_pops==1 &amp;&amp; num_vars==1 &amp;&amp; lock_gca
0500           <span class="comment">% one population per row: dat = data(s=1).(var)(:,1:MTPP) where var=vars{v=r}</span>
0501           var=var_fields{1};
0502           <span class="keyword">switch</span> options.plot_type
0503             <span class="keyword">case</span> <span class="string">'waveform'</span>
0504               dat=data(sim_index).(var);
0505             <span class="keyword">case</span> <span class="string">'power'</span>
0506               AuxData=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).Pxx;
0507               vlines=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).PeakFreq;
0508               AuxDataName={<span class="string">'MUA Power'</span>};
0509               var=[var <span class="string">'_Power_SUA'</span>];
0510               dat=data(sim_index).(var).Pxx;
0511             <span class="keyword">case</span> {<span class="string">'rastergram'</span>,<span class="string">'raster'</span>}
0512               set_name=regexp(var,<span class="string">'^([a-zA-Z0-9]+)_'</span>,<span class="string">'tokens'</span>,<span class="string">'once'</span>);
0513               allspikes{1}=data(sim_index).([var <span class="string">'_spike_times'</span>]);
0514           <span class="keyword">end</span>
0515         <span class="comment">% -----------------------------------------------------------------</span>
0516         <span class="keyword">elseif</span> num_sims==1 &amp;&amp; num_pops==1 &amp;&amp; num_vars&gt;1
0517         <span class="comment">% -----------------------------------------------------------------</span>
0518           <span class="comment">% one variable per row: dat = data(s=1).(var)(:,1:MTPP) where var=vars{v=r}</span>
0519           var=var_fields{row};
0520           <span class="keyword">switch</span> options.plot_type
0521             <span class="keyword">case</span> <span class="string">'waveform'</span>
0522               dat=data(sim_index).(var);
0523             <span class="keyword">case</span> <span class="string">'power'</span>
0524               AuxData=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).Pxx;
0525               vlines=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).PeakFreq;
0526               AuxDataName={<span class="string">'MUA Power'</span>};
0527               var=[var <span class="string">'_Power_SUA'</span>];
0528               dat=data(sim_index).(var).Pxx;
0529             <span class="keyword">case</span> {<span class="string">'rastergram'</span>,<span class="string">'raster'</span>}
0530               set_name=regexp(var,<span class="string">'^([a-zA-Z0-9]+)_'</span>,<span class="string">'tokens'</span>,<span class="string">'once'</span>);
0531               allspikes{1}=data(sim_index).([var <span class="string">'_spike_times'</span>]);
0532           <span class="keyword">end</span>
0533           shared_ylims_flag=0;
0534         <span class="comment">% -----------------------------------------------------------------</span>
0535         <span class="keyword">elseif</span> num_sims==1 &amp;&amp; num_pops&gt;1 &amp;&amp; num_vars==1 &amp;&amp; ~lock_gca
0536         <span class="comment">% -----------------------------------------------------------------</span>
0537           <span class="comment">% one population per row: dat = data(s=1).(var)(:,1:MTPP) where var=vars{v=r}</span>
0538           var=var_fields{row};
0539           <span class="keyword">switch</span> options.plot_type
0540             <span class="keyword">case</span> <span class="string">'waveform'</span>
0541               dat=data(sim_index).(var);
0542             <span class="keyword">case</span> <span class="string">'power'</span>
0543               AuxData=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).Pxx;
0544               vlines=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).PeakFreq;
0545               AuxDataName={<span class="string">'MUA Power'</span>};
0546               var=[var <span class="string">'_Power_SUA'</span>];
0547               dat=data(sim_index).(var).Pxx;
0548             <span class="keyword">case</span> {<span class="string">'rastergram'</span>,<span class="string">'raster'</span>}
0549               set_name=regexp(var,<span class="string">'^([a-zA-Z0-9]+)_'</span>,<span class="string">'tokens'</span>,<span class="string">'once'</span>);
0550               allspikes{1}=data(sim_index).([var <span class="string">'_spike_times'</span>]);
0551           <span class="keyword">end</span>
0552         <span class="comment">% -----------------------------------------------------------------</span>
0553         <span class="keyword">elseif</span> num_sims==1 &amp;&amp; num_pops&gt;1 &amp;&amp; num_vars==1 &amp;&amp; lock_gca
0554         <span class="comment">% -----------------------------------------------------------------</span>
0555           <span class="comment">% one simulation per row, overlay pops: dat = &lt;data(s=r).(var)(:,1:MTPP),2|vars&gt;</span>
0556           <span class="keyword">switch</span> options.plot_type
0557             <span class="keyword">case</span> <span class="string">'waveform'</span>
0558               <span class="comment">% calculate averages across populations</span>
0559               dat=nan(num_times,num_pops);
0560               <span class="keyword">if</span> ~strcmp(reportUI,<span class="string">'matlab'</span>) &amp;&amp; exist(<span class="string">'nanmean'</span>) ~= 2 <span class="comment">% 'nanmean is not in Octave's path</span>
0561                 <span class="keyword">try</span>
0562                   pkg load statistics; <span class="comment">% trying to load octave forge 'statistics' package before using nanmean function</span>
0563                 <span class="keyword">catch</span>
0564                   error(<span class="string">'nanmean function is needed, please install the statistics package from Octave Forge'</span>);
0565                 <span class="keyword">end</span>
0566               <span class="keyword">end</span>
0567               <span class="keyword">for</span> k=1:num_pops
0568                 dat(:,k)=nanmean(data(sim_index).(var_fields{k}),2);
0569               <span class="keyword">end</span>
0570               var=[<span class="string">'&lt;'</span> variables{1} <span class="string">'&gt;'</span>];
0571             <span class="keyword">case</span> <span class="string">'power'</span>
0572               dat=nan(length(xdata),num_pops);
0573               AuxData=nan(length(xdata),num_pops);
0574               AuxDataName={}; vlines=[];
0575               <span class="keyword">if</span> ~strcmp(reportUI,<span class="string">'matlab'</span>) &amp;&amp; exist(<span class="string">'nanmean'</span>) ~= 2 <span class="comment">% 'nanmean is not in Octave's path</span>
0576                 <span class="keyword">try</span>
0577                   pkg load statistics; <span class="comment">% trying to load octave forge 'statistics' package before using nanmean function</span>
0578                 <span class="keyword">catch</span>
0579                   error(<span class="string">'nanmean function is needed, please install the statistics package from Octave Forge'</span>);
0580                 <span class="keyword">end</span>
0581               <span class="keyword">end</span>
0582               <span class="keyword">for</span> k=1:num_pops
0583                 dat(:,k)=nanmean(data(sim_index).([var_fields{k} <span class="string">'_Power_SUA'</span>]).Pxx,2);
0584                 AuxData(:,k)=data(sim_index).([var_fields{k} <span class="string">'_Power_MUA'</span>]).Pxx;
0585                 AuxDataName{end+1}=strrep([var_fields{k} <span class="string">'_Power_MUA'</span>],<span class="string">'_'</span>,<span class="string">'\_'</span>);
0586                 vlines(end+1)=data(sim_index).([var_fields{k} <span class="string">'_Power_MUA'</span>]).PeakFreq;
0587               <span class="keyword">end</span>
0588               var=[<span class="string">'&lt;'</span> variables{1} <span class="string">'_Power_SUA&gt;'</span>];
0589             <span class="keyword">case</span> {<span class="string">'rastergram'</span>,<span class="string">'raster'</span>}
0590               set_name={};
0591               <span class="keyword">for</span> k=1:num_pops
0592                 tmp=regexp(var_fields{k},<span class="string">'^([a-zA-Z0-9]+)_'</span>,<span class="string">'tokens'</span>,<span class="string">'once'</span>);
0593                 set_name{k}=tmp{1};
0594                 allspikes{k}=data(sim_index).([var_fields{k} <span class="string">'_spike_times'</span>]);
0595               <span class="keyword">end</span>
0596               var=[<span class="string">'&lt;'</span> variables{1} <span class="string">'&gt;'</span>];
0597 
0598           <span class="keyword">end</span>
0599         <span class="comment">% -----------------------------------------------------------------</span>
0600         <span class="keyword">elseif</span> num_sims==1 &amp;&amp; num_pops&gt;1 &amp;&amp; num_vars&gt;1
0601         <span class="comment">% -----------------------------------------------------------------</span>
0602           <span class="comment">% one population per row: dat = data(s=1).(var)(:,1:MTPP) where var=vars{these(p=r)}</span>
0603           <span class="keyword">if</span> isnan(pop_var_indices{row}(figset))
0604             <span class="keyword">continue</span>;
0605           <span class="keyword">end</span>
0606           var=var_fields{pop_var_indices{row}(figset)};
0607           <span class="keyword">switch</span> options.plot_type
0608             <span class="keyword">case</span> <span class="string">'waveform'</span>
0609               dat=data(sim_index).(var);
0610             <span class="keyword">case</span> <span class="string">'power'</span>
0611               AuxData=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).Pxx;
0612               vlines=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).PeakFreq;
0613               AuxDataName={<span class="string">'MUA Power'</span>};
0614               var=[var <span class="string">'_Power_SUA'</span>];
0615               dat=data(sim_index).(var).Pxx;
0616             <span class="keyword">case</span> {<span class="string">'rastergram'</span>,<span class="string">'raster'</span>}
0617               set_name=regexp(var,<span class="string">'^([a-zA-Z0-9]+)_'</span>,<span class="string">'tokens'</span>,<span class="string">'once'</span>);
0618               allspikes{1}=data(sim_index).([var <span class="string">'_spike_times'</span>]);
0619           <span class="keyword">end</span>
0620         <span class="comment">% -----------------------------------------------------------------</span>
0621         <span class="keyword">elseif</span> num_sims&gt;1 &amp;&amp; num_pops==1 &amp;&amp; num_vars==1
0622         <span class="comment">% -----------------------------------------------------------------</span>
0623           <span class="comment">% one simulation per row: dat = data(s=r).(var)(:,1:MTPP) where var=vars{v=1}</span>
0624           var=var_fields{1};
0625           <span class="keyword">switch</span> options.plot_type
0626             <span class="keyword">case</span> <span class="string">'waveform'</span>
0627               dat=data(sim_index).(var);
0628             <span class="keyword">case</span> <span class="string">'power'</span>
0629               AuxData=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).Pxx;
0630               vlines=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).PeakFreq;
0631               AuxDataName={<span class="string">'MUA Power'</span>};
0632               var=[var <span class="string">'_Power_SUA'</span>];
0633               dat=data(sim_index).(var).Pxx;
0634             <span class="keyword">case</span> {<span class="string">'rastergram'</span>,<span class="string">'raster'</span>}
0635               set_name=regexp(var,<span class="string">'^([a-zA-Z0-9]+)_'</span>,<span class="string">'tokens'</span>,<span class="string">'once'</span>);
0636               allspikes{1}=data(sim_index).([var <span class="string">'_spike_times'</span>]);
0637           <span class="keyword">end</span>
0638         <span class="comment">% -----------------------------------------------------------------</span>
0639         <span class="keyword">elseif</span> num_sims&gt;1 &amp;&amp; num_pops==1 &amp;&amp; num_vars&gt;1
0640         <span class="comment">% -----------------------------------------------------------------</span>
0641           <span class="comment">% one simulation per row: dat = data(s=r).(var)(:,1:MTPP) where var=vars{v++}</span>
0642           <span class="keyword">if</span> isnan(pop_var_indices{1}(figset))
0643             <span class="keyword">continue</span>;
0644           <span class="keyword">end</span>
0645           var=var_fields{pop_var_indices{1}(figset)};
0646           <span class="keyword">switch</span> options.plot_type
0647             <span class="keyword">case</span> <span class="string">'waveform'</span>
0648               dat=data(sim_index).(var);
0649             <span class="keyword">case</span> <span class="string">'power'</span>
0650               AuxData=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).Pxx;
0651               vlines=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).PeakFreq;
0652               AuxDataName={<span class="string">'MUA Power'</span>};
0653               var=[var <span class="string">'_Power_SUA'</span>];
0654               dat=data(sim_index).(var).Pxx;
0655             <span class="keyword">case</span> {<span class="string">'rastergram'</span>,<span class="string">'raster'</span>}
0656               set_name=regexp(var,<span class="string">'^([a-zA-Z0-9]+)_'</span>,<span class="string">'tokens'</span>,<span class="string">'once'</span>);
0657               allspikes{1}=data(sim_index).([var <span class="string">'_spike_times'</span>]);
0658           <span class="keyword">end</span>
0659         <span class="comment">% -----------------------------------------------------------------</span>
0660         <span class="keyword">elseif</span> num_sims&gt;1 &amp;&amp; num_pops&gt;1 &amp;&amp; num_vars==1
0661         <span class="comment">% -----------------------------------------------------------------</span>
0662           <span class="comment">% one simulation per row, overlay pops: dat = &lt;data(s=r).(var)(:,1:MTPP),2|vars&gt;</span>
0663           <span class="keyword">switch</span> options.plot_type
0664             <span class="keyword">case</span> <span class="string">'waveform'</span>
0665               <span class="comment">% calculate averages across populations</span>
0666               dat=nan(num_times,num_pops);
0667               <span class="keyword">if</span> ~strcmp(reportUI,<span class="string">'matlab'</span>) &amp;&amp; exist(<span class="string">'nanmean'</span>) ~= 2 <span class="comment">% 'nanmean is not in Octave's path</span>
0668                 <span class="keyword">try</span>
0669                   pkg load statistics; <span class="comment">% trying to load octave forge 'statistics' package before using nanmean function</span>
0670                 <span class="keyword">catch</span>
0671                   error(<span class="string">'nanmean function is needed, please install the statistics package from Octave Forge'</span>);
0672                 <span class="keyword">end</span>
0673               <span class="keyword">end</span>
0674               <span class="keyword">for</span> k=1:num_pops
0675                 dat(:,k)=nanmean(data(sim_index).(var_fields{k}),2);
0676               <span class="keyword">end</span>
0677               var=[<span class="string">'&lt;'</span> variables{1} <span class="string">'&gt;'</span>];
0678             <span class="keyword">case</span> <span class="string">'power'</span>
0679               dat=nan(length(xdata),num_pops);
0680               AuxData=nan(length(xdata),num_pops);
0681               AuxDataName={}; vlines=[];
0682               <span class="keyword">if</span> ~strcmp(reportUI,<span class="string">'matlab'</span>) &amp;&amp; exist(<span class="string">'nanmean'</span>) ~= 2 <span class="comment">% 'nanmean is not in Octave's path</span>
0683                 <span class="keyword">try</span>
0684                   pkg load statistics; <span class="comment">% trying to load octave forge 'statistics' package before using nanmean function</span>
0685                 <span class="keyword">catch</span>
0686                   error(<span class="string">'nanmean function is needed, please install the statistics package from Octave Forge'</span>);
0687                 <span class="keyword">end</span>
0688               <span class="keyword">end</span>
0689               <span class="keyword">for</span> k=1:num_pops
0690                 dat(:,k)=nanmean(data(sim_index).([var_fields{k} <span class="string">'_Power_SUA'</span>]).Pxx,2);
0691                 AuxData(:,k)=data(sim_index).([var_fields{k} <span class="string">'_Power_MUA'</span>]).Pxx;
0692                 AuxDataName{end+1}=strrep([var_fields{k} <span class="string">'_Power_MUA'</span>],<span class="string">'_'</span>,<span class="string">'\_'</span>);
0693                 vlines(end+1)=data(sim_index).([var_fields{k} <span class="string">'_Power_MUA'</span>]).PeakFreq;
0694               <span class="keyword">end</span>
0695               var=[<span class="string">'&lt;'</span> variables{1} <span class="string">'_Power_SUA&gt;'</span>];
0696             <span class="keyword">case</span> {<span class="string">'rastergram'</span>,<span class="string">'raster'</span>}
0697               set_name={};
0698               <span class="keyword">for</span> k=1:num_pops
0699                 tmp=regexp(var_fields{k},<span class="string">'^([a-zA-Z0-9]+)_'</span>,<span class="string">'tokens'</span>,<span class="string">'once'</span>);
0700                 set_name{k}=tmp{1};
0701                 allspikes{k}=data(sim_index).([var_fields{k} <span class="string">'_spike_times'</span>]);
0702               <span class="keyword">end</span>
0703               var=[<span class="string">'&lt;'</span> variables{1} <span class="string">'&gt;'</span>];
0704 
0705           <span class="keyword">end</span>
0706         <span class="comment">% -----------------------------------------------------------------</span>
0707         <span class="keyword">elseif</span> num_sims&gt;1 &amp;&amp; num_pops&gt;1 &amp;&amp; num_vars&gt;1
0708         <span class="comment">% -----------------------------------------------------------------</span>
0709           <span class="comment">% one simulation per row, overlay pops: dat = &lt;data(s=r).(var)(:,1:MTPP),2|vars(these)&gt;</span>
0710           <span class="keyword">switch</span> options.plot_type
0711             <span class="keyword">case</span> <span class="string">'waveform'</span>
0712               <span class="comment">% calculate averages across populations</span>
0713               dat=nan(num_times,num_pops);
0714               <span class="keyword">if</span> ~strcmp(reportUI,<span class="string">'matlab'</span>) &amp;&amp; exist(<span class="string">'nanmean'</span>) ~= 2 <span class="comment">% 'nanmean is not in Octave's path</span>
0715                 <span class="keyword">try</span>
0716                   pkg load statistics; <span class="comment">% trying to load octave forge 'statistics' package before using nanmean function</span>
0717                 <span class="keyword">catch</span>
0718                   error(<span class="string">'nanmean function is needed, please install the statistics package from Octave Forge'</span>);
0719                 <span class="keyword">end</span>
0720               <span class="keyword">end</span>
0721               <span class="keyword">for</span> k=1:num_pops
0722                 <span class="keyword">if</span> isnan(pop_var_indices{k}(figset))
0723                   <span class="keyword">continue</span>;
0724                 <span class="keyword">end</span>
0725                 var=var_fields{pop_var_indices{k}(figset)};
0726                 dat(:,k)=nanmean(data(sim_index).(var),2);
0727               <span class="keyword">end</span>
0728               var=[<span class="string">'&lt;'</span> variables{figset} <span class="string">'&gt;'</span>];
0729             <span class="keyword">case</span> <span class="string">'power'</span>
0730               dat=nan(length(xdata),num_pops);
0731               AuxData=nan(length(xdata),num_pops);
0732               AuxDataName={}; vlines=[];
0733               <span class="keyword">if</span> ~strcmp(reportUI,<span class="string">'matlab'</span>) &amp;&amp; exist(<span class="string">'nanmean'</span>) ~= 2 <span class="comment">% 'nanmean is not in Octave's path</span>
0734                 <span class="keyword">try</span>
0735                   pkg load statistics; <span class="comment">% trying to load octave forge 'statistics' package before using nanmean function</span>
0736                 <span class="keyword">catch</span>
0737                   error(<span class="string">'nanmean function is needed, please install the statistics package from Octave Forge'</span>);
0738                 <span class="keyword">end</span>
0739               <span class="keyword">end</span>
0740               <span class="keyword">for</span> k=1:num_pops
0741                 <span class="keyword">if</span> isnan(pop_var_indices{k}(figset))
0742                   <span class="keyword">continue</span>;
0743                 <span class="keyword">end</span>
0744                 var=var_fields{pop_var_indices{k}(figset)};
0745                 dat(:,k)=nanmean(data(sim_index).([var <span class="string">'_Power_SUA'</span>]).Pxx,2);
0746                 AuxData(:,k)=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).Pxx;
0747                 AuxDataName{end+1}=strrep([var <span class="string">'_Power_MUA'</span>],<span class="string">'_'</span>,<span class="string">'\_'</span>);
0748                 vlines(end+1)=data(sim_index).([var <span class="string">'_Power_MUA'</span>]).PeakFreq;
0749               <span class="keyword">end</span>
0750               var=[<span class="string">'&lt;'</span> variables{figset} <span class="string">'_Power_SUA&gt;'</span>];
0751             <span class="keyword">case</span> {<span class="string">'rastergram'</span>,<span class="string">'raster'</span>}
0752               set_name={};
0753               <span class="keyword">for</span> k=1:num_pops
0754                 <span class="keyword">if</span> isnan(pop_var_indices{k}(figset))
0755                   <span class="keyword">continue</span>;
0756                 <span class="keyword">end</span>
0757                 var=var_fields{pop_var_indices{k}(figset)};
0758                 tmp=regexp(var,<span class="string">'^([a-zA-Z0-9]+)_'</span>,<span class="string">'tokens'</span>,<span class="string">'once'</span>);
0759                 set_name{k}=tmp{1};
0760                 allspikes{k}=data(sim_index).([var <span class="string">'_spike_times'</span>]);
0761               <span class="keyword">end</span>
0762               var=[<span class="string">'&lt;'</span> variables{figset} <span class="string">'&gt;'</span>];
0763           <span class="keyword">end</span>
0764         <span class="keyword">end</span>
0765         <span class="comment">% #################################################################</span>
0766         <span class="keyword">if</span> size(dat,2)&gt;1
0767           legend_strings=cellfun(@(x)[<span class="string">'cell '</span> num2str(x)],num2cell(1:min(size(dat,2),max_legend_entries)),<span class="string">'uni'</span>,0);
0768         <span class="keyword">end</span>
0769 
0770         <span class="keyword">if</span> isfield(data,<span class="string">'varied'</span>)
0771           <span class="keyword">if</span> num_sims&gt;1
0772             <span class="comment">% list the parameter varied along the rows first</span>
0773             str=[row_param_name <span class="string">'='</span> num2str(row_param_values(row)) <span class="string">': '</span>];
0774             <span class="keyword">for</span> k=1:num_varied
0775               fld=data(sim_index).varied{k};
0776               <span class="keyword">if</span> ~strcmp(fld,row_param_name)
0777                 val=data(sim_index).(fld);
0778                 str=[str fld <span class="string">'='</span> num2str(val) <span class="string">', '</span>];
0779               <span class="keyword">end</span>
0780             <span class="keyword">end</span>
0781             <span class="keyword">if</span> num_pops&gt;1
0782               legend_strings=cellfun(@(x)[x <span class="string">' (mean)'</span>],pop_names,<span class="string">'uni'</span>,0);
0783             <span class="keyword">end</span>
0784           <span class="keyword">else</span>
0785             str=<span class="string">''</span>;
0786             <span class="keyword">for</span> k=1:length(data.varied)
0787               fld=data(sim_index).varied{k};
0788               str=[str fld <span class="string">'='</span> num2str(data(sim_index).(fld)) <span class="string">', '</span>];
0789             <span class="keyword">end</span>
0790           <span class="keyword">end</span>
0791           text_string{row,col}=[<span class="string">'('</span> strrep(str(1:end-2),<span class="string">'_'</span>,<span class="string">'\_'</span>) <span class="string">')'</span>];
0792         <span class="keyword">end</span>
0793         <span class="keyword">if</span> ~isempty(AuxData) &amp;&amp; length(legend_strings)&lt;=max_legend_entries
0794           legend_strings=cat(2,legend_strings,AuxDataName);
0795         <span class="keyword">end</span>
0796         <span class="comment">% plot data</span>
0797         <span class="comment">%axes(haxes(axis_counter));</span>
0798         set(gcf,<span class="string">'CurrentAxes'</span>,haxes(axis_counter));
0799         <span class="keyword">switch</span> options.plot_type
0800           <span class="keyword">case</span> {<span class="string">'waveform'</span>,<span class="string">'power'</span>}
0801             <span class="comment">% finish preparing data</span>
0802             <span class="keyword">if</span> ~strcmp(options.yscale,<span class="string">'linear'</span>)
0803               dat=feval(options.yscale,dat); <span class="comment">% log or log10</span>
0804               <span class="comment">% alternative approach: use semilogy for log10</span>
0805             <span class="keyword">end</span>
0806             <span class="keyword">if</span> length(options.xlim)==2
0807               sel=(xdata&gt;=options.xlim(1)&amp;xdata&lt;=options.xlim(2));
0808             <span class="keyword">else</span>
0809               sel=1:length(xdata);
0810             <span class="keyword">end</span>
0811             <span class="comment">% plot traces</span>
0812             <span class="keyword">if</span> strcmp(options.plot_mode,<span class="string">'trace'</span>)
0813               <span class="comment">% select max subset allowed</span>
0814               dat=dat(:,1:min(size(dat,2),MTPP)); <span class="comment">% select max subset to plot</span>
0815               plot(xdata(sel),dat(sel,:));
0816               set(gca,<span class="string">'ticklength'</span>,get(gca,<span class="string">'ticklength'</span>)/2) <span class="comment">%make ticks shorter</span>
0817             <span class="keyword">else</span>
0818               imagesc(dat);
0819             <span class="keyword">end</span>
0820           <span class="keyword">case</span> {<span class="string">'rastergram'</span>,<span class="string">'raster'</span>}
0821             <span class="comment">% draw spikes</span>
0822             ypos=0; <span class="comment">% y-axis position tracker</span>
0823             yticks=[]; <span class="comment">% where to position population names</span>
0824             yticklabels={}; <span class="comment">% population names</span>
0825             <span class="keyword">for</span> p=1:length(allspikes) <span class="comment">% loop over populations</span>
0826               spikes=allspikes{p}; <span class="comment">% spikes for one population</span>
0827               <span class="keyword">for</span> c=1:length(spikes) <span class="comment">% loop over cells in population p</span>
0828                 spks=spikes{c}; <span class="comment">% spikes for one cell</span>
0829                 <span class="keyword">for</span> k=1:length(spks) <span class="comment">% loop over spikes for cell c</span>
0830                   spk=spks(k); <span class="comment">% time of spike k in cell c of population p</span>
0831                   line([spk spk],[c+ypos-.5 c+ypos+.5],<span class="string">'color'</span>,<span class="string">'k'</span>); hold on
0832                 <span class="keyword">end</span>
0833               <span class="keyword">end</span>
0834               <span class="comment">% record position for population tick name</span>
0835               yticks(end+1)=ypos+c/2+.5;
0836               yticklabels{end+1}=set_name{p};
0837               <span class="comment">% draw line separating populations</span>
0838               <span class="keyword">if</span> length(allspikes)&gt;1
0839                 pos=c+ypos+.5;
0840                 line([min(time) max(time)],[pos pos],<span class="string">'color'</span>,<span class="string">'k'</span>,<span class="string">'linewidth'</span>,3);
0841                 <span class="keyword">if</span> p&lt;length(allspikes)
0842                   <span class="comment">% increment y-position for next population</span>
0843                   ypos=ypos+c;
0844                 <span class="keyword">end</span>
0845               <span class="keyword">end</span>
0846             <span class="keyword">end</span>
0847             <span class="comment">% artificially set &quot;dat&quot; to get correct ylims below</span>
0848             dat=[.5 ypos+c+.5];
0849             shared_ylims_flag=0;
0850             legend_strings=<span class="string">''</span>;
0851             <span class="comment">% set y-ticks to population names</span>
0852             set(gca,<span class="string">'ytick'</span>,yticks,<span class="string">'yticklabel'</span>,yticklabels);
0853             <span class="comment">% set x-ticks</span>
0854             plot([min(time) max(time)],[.5 .5],<span class="string">'w'</span>);
0855             nticks=length(get(gca,<span class="string">'xtick'</span>));
0856             xticks=linspace(options.xlim(1),options.xlim(2),nticks);
0857             set(gca,<span class="string">'xtick'</span>,xticks,<span class="string">'xticklabel'</span>,xticks);
0858             <span class="comment">%set(gca,'xticklabel',get(gca,'ytick'));</span>
0859             set(gca,<span class="string">'ticklength'</span>,get(gca,<span class="string">'ticklength'</span>)/2) <span class="comment">%make ticks shorter</span>
0860         <span class="keyword">end</span> <span class="comment">% end switch options.plot_type</span>
0861         <span class="comment">% plot auxiliary data</span>
0862         <span class="keyword">if</span> ~isempty(AuxData) <span class="comment">%strcmp(options.plot_type,'power')</span>
0863           hold on
0864           plot(xdata(sel),AuxData(sel,:),<span class="string">'-'</span>,<span class="string">'linewidth'</span>,3);<span class="comment">%,'o-','linewidth',3);%'--.');</span>
0865         <span class="keyword">end</span>
0866         <span class="comment">% format axes</span>
0867         <span class="keyword">if</span> row==num_rows
0868           xlabel(xlab);
0869         <span class="keyword">else</span>
0870           set(haxes(axis_counter),<span class="string">'XTickLabel'</span>,<span class="string">''</span>);
0871           <span class="comment">%set(haxes(row),'YTickLabel','');</span>
0872         <span class="keyword">end</span>
0873         xlim(options.xlim);
0874         <span class="keyword">if</span> ~strcmp(options.plot_type,<span class="string">'rastergram'</span>)
0875           ylabel(strrep(var,<span class="string">'_'</span>,<span class="string">'\_'</span>));
0876         <span class="keyword">end</span>
0877         <span class="keyword">if</span> ~isempty(options.ylim)
0878           ylims=options.ylim;
0879         <span class="keyword">elseif</span> shared_ylims_flag
0880           <span class="comment">% update max/min</span>
0881           ylims(1)=min(ylims(1),min(dat(:)));
0882           ylims(2)=max(ylims(2),max(dat(:)));
0883         <span class="keyword">else</span>
0884           <span class="comment">% set ylim to max/min of this data set</span>
0885           ylims=[min(dat(:)) max(dat(:))];
0886           <span class="keyword">if</span> ylims(1)~=ylims(2)
0887             ylim(ylims);
0888           <span class="keyword">end</span>
0889           <span class="comment">% add text</span>
0890           <span class="keyword">if</span> ~isempty(text_string)
0891             xmin=min(xlim); xmax=max(xlim);
0892             ymin=min(dat(:)); ymax=max(dat(:));
0893             text_xpos=xmin+.05*(xmax-xmin);
0894             text_ypos=ymin+.9*(ymax-ymin);
0895             <span class="keyword">try</span>
0896               <span class="keyword">if</span> any(strcmp(options.plot_type, {<span class="string">'rastergram'</span>,<span class="string">'raster'</span>}))
0897                 xlims = double(get(gca,<span class="string">'xlim'</span>));
0898                 ylims = double(get(gca,<span class="string">'ylim'</span>));
0899                 text(0.05*xlims(end),0.9*ylims(end),text_string{row,col});
0900               <span class="keyword">else</span>
0901                 text(text_xpos,text_ypos,text_string{row,col});
0902               <span class="keyword">end</span>
0903             <span class="keyword">end</span>
0904           <span class="keyword">end</span>
0905         <span class="keyword">end</span>
0906         <span class="comment">% plot lines and text (used for power)</span>
0907         <span class="keyword">if</span> ~isempty(vlines)
0908           <span class="keyword">for</span> k=1:length(vlines)
0909             <span class="keyword">if</span> ~isnan(vlines(k))
0910               line([vlines(k) vlines(k)],ylim,<span class="string">'color'</span>,<span class="string">'k'</span>,<span class="string">'linestyle'</span>,<span class="string">'--'</span>);
0911               ymax=max(ylim);
0912               text(double(vlines(k) + 0.1*range(xlim)), 0.9*ymax, sprintf(<span class="string">'MUA Sxx Peak F: %.f'</span>, vlines(k)))
0913             <span class="keyword">end</span>
0914           <span class="keyword">end</span>
0915         <span class="keyword">end</span>
0916         <span class="comment">% add legend</span>
0917         <span class="keyword">if</span> ~isempty(legend_strings) &amp;&amp; axis_counter==1
0918           legend(legend_strings);
0919         <span class="keyword">end</span>
0920       <span class="keyword">end</span> <span class="comment">% end loop over subplot columns</span>
0921     <span class="keyword">end</span> <span class="comment">% end loop over subplot rows</span>
0922     <span class="comment">% set y-limits to max/min over data in this figure</span>
0923     <span class="keyword">if</span> shared_ylims_flag || ~isempty(options.ylim)
0924       <span class="keyword">if</span> ylims(1)~=ylims(2)
0925         set(haxes,<span class="string">'ylim'</span>,ylims);
0926       <span class="keyword">end</span>
0927       <span class="keyword">if</span> ~isempty(text_string)
0928         axis_counter=0;
0929         <span class="keyword">for</span> row=1:num_rows
0930           <span class="keyword">for</span> col=1:num_cols
0931             <span class="keyword">if</span> ~ischar(text_string{row,col})
0932               <span class="keyword">continue</span>;
0933             <span class="keyword">end</span>
0934             axis_counter=axis_counter+1;
0935             <span class="comment">%axes(haxes(axis_counter));</span>
0936             set(gcf,<span class="string">'CurrentAxes'</span>,haxes(axis_counter));
0937             xmin=min(xlim); xmax=max(xlim);
0938             ymin=min(ylim); ymax=max(ylim);
0939             text_xpos=double(xmin+.05*(xmax-xmin));
0940             text_ypos=ymin+.9*(ymax-ymin);
0941             text(text_xpos,text_ypos,text_string{row,col});
0942           <span class="keyword">end</span>
0943         <span class="keyword">end</span>
0944       <span class="keyword">end</span>
0945     <span class="keyword">end</span>
0946 
0947     <span class="comment">%link x axes</span>
0948     <span class="keyword">if</span> numel(haxes) &gt; 1
0949       linkaxes(haxes, <span class="string">'x'</span>)
0950     <span class="keyword">end</span>
0951 
0952   <span class="keyword">end</span> <span class="comment">% end loop over figures in this set</span>
0953 <span class="keyword">end</span> <span class="comment">% end loop over figure sets</span>
0954 
0955 <span class="comment">%% auto_gen_test_data_flag argout</span>
0956 <span class="keyword">if</span> options.auto_gen_test_data_flag
0957   argout = {handles}; <span class="comment">% specific to this function</span>
0958 
0959   <a href="../functions/internal/unit-test/dsUnitSaveAutoGenTestDir.html" class="code" title="function dsUnitSaveAutoGenTestDir(argin, argout, dirIn, dirOut, localFn_flag)">dsUnitSaveAutoGenTestDir</a>(argin, argout);
0960 <span class="keyword">end</span>
0961 
0962 <span class="comment">% 1 sim, 1 pop, 1 var (X)</span>
0963 <span class="comment">%     N=1        one fig, one row (plot var X)</span>
0964 <span class="comment">%     N&gt;1        one row per cell (plot var X),             enough figs for all cells</span>
0965 <span class="comment">%     (nsims=1, num_pops=1, num_vars=1, pop_sizes&gt;=1): num_fig_sets=1, num_figs=ceil(pop_sizes/MRPF), num_rows=min(pop_sizes,MRPF): row r: dat = data(s=1).(var)(:,c=r) where var=vars{v=1}</span>
0966 <span class="comment">%</span>
0967 <span class="comment">% 1 sim, 1 pop, &gt;1 vars (X,Y,...)</span>
0968 <span class="comment">%     N=1        one row per var (plot cell 1),             enough figs for all vars</span>
0969 <span class="comment">%     N&gt;1        one row per var (overlay cells),         enough figs for all vars</span>
0970 <span class="comment">%     (nsims=1, num_pops=1, num_vars&gt;=1, pop_sizes&gt;=1): num_fig_sets=1, num_figs=ceil(num_vars/MRPF), num_rows=min(num_vars,MRPF): row r: dat = data(s=1).(var)(:,1:MTPP) where var=vars{v=r}</span>
0971 <span class="comment">%</span>
0972 <span class="comment">% 1 sim, &gt;1 pops, 1 var (X)</span>
0973 <span class="comment">%     all N=1        one row per pop (plot var X, cell 1),        enough figs for all pops</span>
0974 <span class="comment">%     any N&gt;1        one row per pop (plot var X, overlay cells),     enough figs for all pops</span>
0975 <span class="comment">%     (nsims=1, num_pops&gt;=1, num_vars=1, pop_sizes&gt;=1): num_fig_sets=1, num_figs=ceil(num_pops/MRPF), num_rows=min(num_pops,MRPF): row r: dat = data(s=1).(var)(:,1:MTPP) where var=vars{v=r}</span>
0976 <span class="comment">%</span>
0977 <span class="comment">% 1 sim, &gt;1 pops, &gt;1 vars (X,Y,...)</span>
0978 <span class="comment">%     all N=1        one row per pop (plot var X, cell 1),         enough figs for all pops, separate figs for each var</span>
0979 <span class="comment">%     any N&gt;1        one row per pop (plot var X, overlay cells),     enough figs for all pops, separate figs for each var</span>
0980 <span class="comment">%     (nsims=1, num_pops&gt;=1, num_vars&gt;=1, pop_sizes&gt;=1): num_fig_sets=num_vars, num_figs=ceil(num_pops/MRPF), num_rows=min(num_pops,MRPF): row r: dat = data(s=1).(var)(:,1:MTPP) where var=vars{these(p=r)}</span>
0981 <span class="comment">%</span>
0982 <span class="comment">% &gt;1 sim, 1 pop, 1 var (X)</span>
0983 <span class="comment">%     N=1        one row per sim (plot var X, cell 1),         enough figs for all sims</span>
0984 <span class="comment">%     N&gt;1        one row per sim (plot var X, overlay cells),     enough figs for all sims</span>
0985 <span class="comment">%     (nsims&gt;1, num_pops=1, num_vars=1, pop_sizes&gt;=1): num_fig_sets=1, num_figs=ceil(nsims/MRPF), num_rows=min(nsims,MRPF): row r: dat = data(s=r).(var)(:,1:MTPP) where var=vars{v=1}</span>
0986 <span class="comment">%</span>
0987 <span class="comment">% &gt;1 sim, 1 pop, &gt;1 vars (X,Y,...)</span>
0988 <span class="comment">%     N=1        one row per sim (plot var X, cell 1),         enough figs for all sims, separate figs for each var</span>
0989 <span class="comment">%     N&gt;1        one row per sim (plot var X, overlay cells),     enough figs for all sims, separate figs for each var</span>
0990 <span class="comment">%     (nsims&gt;1, num_pops=1, num_vars=1, pop_sizes&gt;=1): num_fig_sets=num_vars, num_figs=ceil(nsims/MRPF), num_rows=min(nsims,MRPF): row r: dat = data(s=r).(var)(:,1:MTPP) where var=vars{v++}</span>
0991 <span class="comment">%</span>
0992 <span class="comment">% &gt;1 sim, &gt;1 pops, 1 var (X)</span>
0993 <span class="comment">%     all N=1        one row per sim (plot var X, overlay pops),    enough figs for all sims</span>
0994 <span class="comment">%     any N&gt;1        one row per sim (plot var &lt;X&gt;, overlay pops),    enough figs for all sims</span>
0995 <span class="comment">%     (nsims&gt;1, num_pops=1, num_vars=1, pop_sizes&gt;=1): num_fig_sets=1, num_figs=ceil(nsims/MRPF), num_rows=min(nsims,MRPF): row r: dat = &lt;data(s=r).(var)(:,1:MTPP),2|vars&gt;</span>
0996 <span class="comment">%</span>
0997 <span class="comment">% &gt;1 sim, &gt;1 pops, &gt;1 vars (X,Y,...)</span>
0998 <span class="comment">%     all N=1        one row per sim (plot var X, overlay pops),    enough figs for all sims, separate figs for each var</span>
0999 <span class="comment">%     any N&gt;1        one row per sim (plot var &lt;X&gt;, overlay pops),    enough figs for all sims, separate figs for each var</span>
1000 <span class="comment">%     (nsims&gt;1, num_pops=1, num_vars=1, pop_sizes&gt;=1): num_fig_sets=num_vars, num_figs=ceil(nsims/MRPF), num_rows=min(nsims,MRPF): row r: dat = &lt;data(s=r).(var)(:,1:MTPP),2|vars(these)&gt;</span>
1001 
1002 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5</span></pre></div>
<hr><address>Generated on Tue 12-Dec-2017 11:32:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>