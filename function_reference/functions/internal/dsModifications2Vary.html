<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of dsModifications2Vary</title>
  <meta name="keywords" content="dsModifications2Vary">
  <meta name="description" content="Adds fields tmpdata.varied and tmpdata.(varied{1}) ...">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>

<a name="_top"></a>
<div><a href="../../menu.html">Home</a> &gt;  <a href="../menu.html">functions</a> &gt; <a href="menu.html">internal</a> &gt; dsModifications2Vary.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../menu.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="menu.html">Index for functions/internal&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>dsModifications2Vary
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Adds fields tmpdata.varied and tmpdata.(varied{1}) ...</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function data = dsModifications2Vary(data,modifications,options,modifications_set,sim) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Adds fields tmpdata.varied and tmpdata.(varied{1}) ...
 tmpdata.varied({N}) to tmpdata. This contains information about
 parameters varied across each sim.

 Usage:
   data = modifications2Vary(data,modifications)
   data = modifications2Vary(data,modifications,options)
   data = modifications2Vary(data,modifications,options,modifications_set,sim)

 Inputs:
   data: DynaSim data structure
   modifications: modifications to make to specification structure
       {X,Y,Z; X,Y,Z; ...}
       X = population name or connection source-&gt;target
       Y = thing to modify ('name', 'size', or parameter name)
       set Y=Z if Y = name, size, or value
       Note: (X1,X2) or (Y1,Y2): modify these simultaneously in the same way
       Note: modifications is often found in options.modifications


 Inputs (Optional):
   options : Options structure containing experiment OR precision
   fields (see dsSimulate)
   modifications_set : Additional modifications, produced by
                       dsVary2Modifications(options.vary,model);
   sim : simulation number

 Outputs:
   data: DynaSim data structure

 Examples:
   tmpdata = dsModifications2Vary(tmpdata,options.modifications,options,modifications_set,sim);
   tmp_data = dsModifications2Vary(tmp_data,modifications);


 Author: Dave Stanley; based on prepare_varied_metadata by ??? (Jason
 Sherfey?); Boston University; 2017

 See also: <a href="dsVary2Modifications.html" class="code" title="function modifications_set = dsVary2Modifications(vary,model)">dsVary2Modifications</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../functions/dsSimulate.html" class="code" title="function [data,studyinfo,result] = dsSimulate(model,varargin)">dsSimulate</a>	% data=dsSimulate(model,'option',value,...)</li><li><a href="dsImportPlots.html" class="code" title="function [data,studyinfo] = dsImportPlots(file,varargin)">dsImportPlots</a>	IMPORTPLOTS - load info about saved images (generated by SimulateMode or dsAnalyze) alongwith corresponding varied model components.</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function modifications=expand_modifications(mods)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function data = dsModifications2Vary(data,modifications,options,modifications_set,sim)</a>
0002     <span class="comment">% Adds fields tmpdata.varied and tmpdata.(varied{1}) ...</span>
0003     <span class="comment">% tmpdata.varied({N}) to tmpdata. This contains information about</span>
0004     <span class="comment">% parameters varied across each sim.</span>
0005     <span class="comment">%</span>
0006     <span class="comment">% Usage:</span>
0007     <span class="comment">%   data = modifications2Vary(data,modifications)</span>
0008     <span class="comment">%   data = modifications2Vary(data,modifications,options)</span>
0009     <span class="comment">%   data = modifications2Vary(data,modifications,options,modifications_set,sim)</span>
0010     <span class="comment">%</span>
0011     <span class="comment">% Inputs:</span>
0012     <span class="comment">%   data: DynaSim data structure</span>
0013     <span class="comment">%   modifications: modifications to make to specification structure</span>
0014     <span class="comment">%       {X,Y,Z; X,Y,Z; ...}</span>
0015     <span class="comment">%       X = population name or connection source-&gt;target</span>
0016     <span class="comment">%       Y = thing to modify ('name', 'size', or parameter name)</span>
0017     <span class="comment">%       set Y=Z if Y = name, size, or value</span>
0018     <span class="comment">%       Note: (X1,X2) or (Y1,Y2): modify these simultaneously in the same way</span>
0019     <span class="comment">%       Note: modifications is often found in options.modifications</span>
0020     <span class="comment">%</span>
0021     <span class="comment">%</span>
0022     <span class="comment">% Inputs (Optional):</span>
0023     <span class="comment">%   options : Options structure containing experiment OR precision</span>
0024     <span class="comment">%   fields (see dsSimulate)</span>
0025     <span class="comment">%   modifications_set : Additional modifications, produced by</span>
0026     <span class="comment">%                       dsVary2Modifications(options.vary,model);</span>
0027     <span class="comment">%   sim : simulation number</span>
0028     <span class="comment">%</span>
0029     <span class="comment">% Outputs:</span>
0030     <span class="comment">%   data: DynaSim data structure</span>
0031     <span class="comment">%</span>
0032     <span class="comment">% Examples:</span>
0033     <span class="comment">%   tmpdata = dsModifications2Vary(tmpdata,options.modifications,options,modifications_set,sim);</span>
0034     <span class="comment">%   tmp_data = dsModifications2Vary(tmp_data,modifications);</span>
0035     <span class="comment">%</span>
0036     <span class="comment">%</span>
0037     <span class="comment">% Author: Dave Stanley; based on prepare_varied_metadata by ??? (Jason</span>
0038     <span class="comment">% Sherfey?); Boston University; 2017</span>
0039     <span class="comment">%</span>
0040     <span class="comment">% See also: dsVary2Modifications</span>
0041 
0042 
0043     <span class="comment">% add things varied to tmpdata</span>
0044     mods={};
0045     <span class="keyword">if</span> ~isempty(modifications)
0046       mods=cat(1,mods,<a href="#_sub1" class="code" title="subfunction modifications=expand_modifications(mods)">expand_modifications</a>(modifications));
0047     <span class="keyword">end</span>
0048 
0049     <span class="keyword">if</span> nargin &gt; 3
0050         <span class="keyword">if</span> ~isempty(modifications_set{sim})
0051           tmp_mods=<a href="#_sub1" class="code" title="subfunction modifications=expand_modifications(mods)">expand_modifications</a>(modifications_set{sim});
0052           mods=cat(1,mods,tmp_mods);
0053         <span class="keyword">end</span>
0054     <span class="keyword">end</span>
0055 
0056     <span class="keyword">if</span> nargin &gt; 2
0057         <span class="keyword">if</span> isa(options.experiment,<span class="string">'function_handle'</span>)
0058           <span class="keyword">for</span> j=1:length(data)
0059             data(j).simulator_options.modifications=mods;
0060           <span class="keyword">end</span>
0061         <span class="keyword">end</span>
0062     <span class="keyword">end</span>
0063 
0064     <span class="keyword">if</span> ~isempty(mods)
0065       <span class="keyword">if</span> isfield(data,<span class="string">'varied'</span>)
0066         varied=data(1).varied;
0067       <span class="keyword">else</span>
0068         varied={};
0069       <span class="keyword">end</span>
0070 
0071       <span class="keyword">for</span> ii=1:size(mods,1)
0072         <span class="comment">% prepare valid field name for thing varied:</span>
0073         fld=[mods{ii,1} <span class="string">'_'</span> mods{ii,2}];
0074 
0075         <span class="comment">% convert arrows and periods to underscores</span>
0076         fld=regexprep(fld,<span class="string">'(-&gt;)|(&lt;-)|(-)|(\.)'</span>,<span class="string">'_'</span>);
0077 
0078         <span class="comment">% remove brackets and parentheses</span>
0079         fld=regexprep(fld,<span class="string">'[\[\]\(\)\{\}]'</span>,<span class="string">''</span>);
0080 
0081         <span class="comment">% remove spaces</span>
0082         fld=regexprep(fld,<span class="string">'[\ ]'</span>,<span class="string">''</span>);
0083 
0084         <span class="keyword">for</span> j=1:length(data)
0085           data(j).(fld)=mods{ii,3};
0086         <span class="keyword">end</span>
0087 
0088         <span class="keyword">if</span> ~ismember(fld,varied)
0089           varied{end+1}=fld;
0090         <span class="keyword">end</span>
0091       <span class="keyword">end</span>
0092 
0093       <span class="keyword">for</span> j=1:length(data)
0094         data(j).varied=varied;
0095       <span class="keyword">end</span>
0096     <span class="keyword">end</span>
0097     <span class="comment">% convert tmpdata to single precision</span>
0098     <span class="keyword">if</span> nargin &gt; 2
0099         <span class="keyword">if</span> strcmp(options.precision,<span class="string">'single'</span>)
0100           <span class="keyword">for</span> j=1:length(data)
0101             <span class="keyword">for</span> k=1:length(data(j).labels)
0102               fld=data(j).labels{k};
0103               data(j).(fld)=single(data(j).(fld));
0104             <span class="keyword">end</span>
0105           <span class="keyword">end</span>
0106         <span class="keyword">end</span>
0107     <span class="keyword">end</span>
0108 <span class="keyword">end</span>
0109 
0110 <a name="_sub1" href="#_subfunctions" class="code">function modifications=expand_modifications(mods)</a>
0111 <span class="comment">% purpose: expand simultaneous modifications into larger list</span>
0112 modifications={};
0113 <span class="keyword">for</span> i=1:size(mods,1)
0114   <span class="comment">% get object list without grouping symbols: ()[]{}</span>
0115   objects=regexp(mods{i,1},<span class="string">'[^\(\)\[\]\{\},]+'</span>,<span class="string">'match'</span>);
0116   variables=regexp(mods{i,2},<span class="string">'[^\(\)\[\]\{\},]+'</span>,<span class="string">'match'</span>);
0117 
0118   <span class="keyword">for</span> j=1:length(objects)
0119     <span class="keyword">for</span> k=1:length(variables)
0120       thisMod = mods{i,3};
0121 
0122       <span class="keyword">if</span> all(size(thisMod) == [1,1]) <span class="comment">%same val for each obj and var</span>
0123         modifications(end+1,1:3)={objects{j},variables{k},thisMod};
0124       <span class="keyword">elseif</span> (size(thisMod,1) &gt; 1) &amp;&amp; (size(thisMod,2) == 1) <span class="comment">%same val for each obj, diff for each var</span>
0125         modifications(end+1,1:3)={objects{j},variables{k},thisMod(k)};
0126       <span class="keyword">elseif</span> (size(thisMod,1) == 1) &amp;&amp; (size(thisMod,2) &gt; 1) <span class="comment">%same val for each var, diff for each obj</span>
0127         modifications(end+1,1:3)={objects{j},variables{k},thisMod(j)};
0128       <span class="keyword">elseif</span> (size(thisMod,1) &gt; 1) &amp;&amp; (size(thisMod,2) &gt; 1) <span class="comment">%diff val for each var and obj</span>
0129         modifications(end+1,1:3)={objects{j},variables{k},thisMod(k,j)};
0130       <span class="keyword">else</span>
0131         error(<span class="string">'Unknown modification type (likely due to excess dims)'</span>)
0132       <span class="keyword">end</span> <span class="comment">%if</span>
0133     <span class="keyword">end</span> <span class="comment">%k</span>
0134   <span class="keyword">end</span> <span class="comment">%j</span>
0135 <span class="keyword">end</span> <span class="comment">%i</span>
0136 <span class="keyword">end</span>  <span class="comment">%fun</span></pre></div>
<hr><address>Generated on Tue 12-Dec-2017 11:32:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>